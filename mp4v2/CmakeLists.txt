cmake_minimum_required(VERSION 3.4.1)
SET(src_dir src)
SET(inc_dir include)
SET(lib_name mp4v2)
SET(lib_static ${lib_name})
SET(lib_shared ${lib_name}_shared)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wall -fexceptions -Wno-write-strings -O2 -DHAVE_SOCKLEN_T -DHAVE_STRUCT_IOVEC")

message("------------------------------Cmake build ${lib_name}-----------------------------")
message("project source dir==>${PROJECT_SOURCE_DIR}")
message("Cmake file dir==>${CMAKE_CURRENT_SOURCE_DIR}")

aux_source_directory(src source_files)
aux_source_directory(src/bmff source_files)
aux_source_directory(src/itmf source_files)
aux_source_directory(src/qtff source_files)
aux_source_directory(libplatform source_files)
aux_source_directory(libplatform/io source_files)
aux_source_directory(libplatform/number source_files)
aux_source_directory(libplatform/process source_files)
aux_source_directory(libplatform/prog source_files)
aux_source_directory(libplatform/sys source_files)
aux_source_directory(libplatform/time source_files)
aux_source_directory(libutil source_files)


#排序之后的文件
message("-----------------The following is the sorted source file--------------------")
foreach (_var ${source_files})
    if (_var MATCHES "_win32.cpp")
        message("remove win32==>${_var}")
        list(REMOVE_ITEM source_files ${_var})
    endif ()
endforeach ()


set_property(SOURCE ${source_files} APPEND_STRING PROPERTY COMPILE_FLAGS " ")


add_library(${lib_static} STATIC ${source_files})
target_include_directories(${lib_static} PRIVATE . include src libplatform libutil)
target_compile_options(${lib_static}
        PRIVATE
        -std=c++03)